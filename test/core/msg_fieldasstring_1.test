%description:
Test that the generated getFieldValueAsString() makes use of @toString, @str,
cObject::str(), etc.

%file: test.msg
class None {
    int x = 13;
}

class FooStr {
    int x = 42;
    @str("Foo{x="+std::to_string(getX())+"}");
}

class FooToString {
    int x = 68;
    @toString(.info());
}

cplusplus(FooToString) {{
    std::string info() const {return "Foo{x=" + std::to_string(getX()) + "}";}
}}

class Dummy extends cObject {
    None none;
    FooStr fooStr;
    FooToString fooToString;
    omnetpp::cMessage msg;
}

%includes:
#include "test_m.h"

%activity:
Dummy *dummy = new Dummy();

cClassDescriptor *desc = dummy->getDescriptor();
for (int i = 0; i < desc->getFieldCount(); i++)
    EV << desc->getFieldName(i) << "=\"" << desc->getFieldValueAsString(toAnyPtr(dummy), i, 0) << "\"\n";

%subst: /omnetpp:://
%contains: stdout
className="Dummy"
name=""
fullName=""
fullPath=""
info=""
none=""
fooStr="Foo{x=42}"
fooToString="Foo{x=68}"
msg="(new msg)"
